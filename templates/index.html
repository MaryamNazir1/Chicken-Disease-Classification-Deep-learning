<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Object Classification</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(-45deg, #e0f7fa, #e1bee7, #bbdefb, #f3e5f5);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      font-family: "Segoe UI", sans-serif;
    }

    @keyframes gradientBG {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }

    .card {
      border-radius: 1rem;
      box-shadow: 0px 6px 20px rgba(0,0,0,0.15);
      transition: transform 0.3s ease;
    }
    .card:hover {
      transform: translateY(-6px);
    }

    .title {
      font-size: 2.2rem;
      font-weight: 700;
      color: #1b2d6b;
    }

    .btn-custom {
      border-radius: 50px;
      padding: 0.6rem 1.4rem;
      font-weight: 600;
    }

    .preview-img, video {
      width: 100%;
      height: 300px;
      border-radius: 0.8rem;
      object-fit: cover;
      border: 2px dashed #1b2d6b;
      transition: all 0.3s ease;
    }

    .preview-img:hover {
      border-color: #00c853;
    }

    .jsonRes {
      background: #111;
      color: #00ff9d;
      padding: 12px;
      border-radius: 0.5rem;
      font-family: monospace;
      font-size: 0.85rem;
      max-height: 280px;
      overflow: auto;
      display: none;
    }

    #loading {
      position: fixed;
      top:0; left:0;
      width:100%; height:100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(255,255,255,0.8);
      z-index: 9999;
      display: none;
    }
    .spinner-border {
      width: 4rem;
      height: 4rem;
      color: #1b2d6b;
    }

    /* Badge Styling */
    .result-badge {
      font-size: 1.2rem;
      padding: 10px 20px;
      border-radius: 30px;
      font-weight: 600;
    }

    .fade-in {
      animation: fadeIn 1s ease forwards;
    }

    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(10px);}
      to {opacity: 1; transform: translateY(0);}
    }

    /* GitHub Button */
    .github-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #24292e;
      color: white;
      padding: 12px 20px;
      border-radius: 50px;
      font-weight: 600;
      text-decoration: none;
      transition: 0.3s ease;
    }
    .github-btn:hover {
      background: #0366d6;
      color: #fff;
      text-decoration: none;
    }
    .github-btn svg {
      width: 20px;
      height: 20px;
      fill: white;
    }
  </style>
</head>
<body>
<div class="container py-5">
  <h1 class="text-center title mb-5">ðŸ“· Chicken Disease Classification</h1>
  <div class="row g-4">
    <!-- Upload & Preview -->
    <div class="col-md-6">
      <div class="card p-4">
        <h5 class="mb-3 text-center">Upload Image</h5>
        <div class="text-center mb-3">
          <video autoplay id="video" class="preview-img"></video>
          <img src="" id="photo" class="preview-img d-none">
          <canvas style="display:none;" id="canvas"></canvas>
        </div>
        <div class="d-flex justify-content-center gap-3">
          <button type="button" class="btn btn-primary btn-custom" id="uload">Upload</button>
          <button id="send" type="button" class="btn btn-success btn-custom">Predict</button>
        </div>
        <input name="upload" type="file" id="fileinput" class="d-none"/>
        <input type="hidden" id="url" value="../predict"/>
      </div>
    </div>

    <!-- Results -->
    <div class="col-md-6">
      <div class="card p-4">
        <h5 class="mb-3 text-center">Prediction Results</h5>
        <div id="imageResult" class="text-center mb-3"></div>
        <div id="predictionText" class="text-center"></div>
        <button class="btn btn-link mt-3" onclick="$('#jsonRes').toggle()">Show Raw JSON</button>
        <div class="jsonRes mt-2" id="jsonRes">Waiting for prediction...</div>
      </div>
    </div>
  </div>

  <!-- GitHub Button -->
  <div class="text-center mt-5">
    <a class="github-btn" href="https://github.com/MaryamNazir1" target="_blank">
      <svg viewBox="0 0 16 16" aria-hidden="true">
        <path fill-rule="evenodd"
              d="M8 0C3.58 0 0 3.58 0 8c0 3.54
                 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38
                 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94
                 -.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53
                 .63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66
                 .07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95
                 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12
                 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09
                 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16
                 1.92.08 2.12.51.56.82 1.27.82 2.15
                 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54
                 1.48 0 1.07-.01 1.93-.01 2.2
                 0 .21.15.46.55.38A8.013 8.013 0 0016 8
                 c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
      View on GitHub
    </a>
  </div>
</div>

<!-- Loader -->
<div id="loading">
  <div class="spinner-border" role="status"></div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
var base_data = "";

function sendRequest(base64Data){
  if(!base64Data) return;

  $("#loading").show();
  $.ajax({
    url : $("#url").val(),
    type: "post",
    cache: false,
    async: true,
    crossDomain: true,
    headers: {
      'Content-Type': 'application/json',
      'Access-Control-Allow-Origin':'*'
    },
    data:JSON.stringify({image:base64Data}),
    success: function(res){
      $("#loading").hide();
      $("#imageResult").html("");
      $("#jsonRes").html("");

      // Show result image if exists
      try{
        var imageData = res[1]?.image;
        if(imageData && imageData.length > 50){
          $("#imageResult").html(`<img src="data:image/jpeg;base64,${imageData}" class="img-fluid rounded shadow fade-in">`);
        }
      }catch(e){}

      // Show prediction as badge
      let prediction = res[0]?.image || "Unknown";
      let badgeColor = prediction.toLowerCase().includes("healthy") ? "success" : "danger";
      $("#predictionText").html(`<span class="badge bg-${badgeColor} result-badge fade-in">${prediction}</span>`);

      // Raw JSON
      $("#jsonRes").html("<pre>" + JSON.stringify(res, null, 2) + "</pre>");
    }
  });
}

$(document).ready(function(){
  $('#send').click(() => sendRequest(base_data));
  $('#uload').click(() => $('#fileinput').click());

  $("#fileinput").change(function(){
    if (this.files && this.files[0]){
      var reader = new FileReader();
      reader.onload = function (e){
        var url = e.target.result;
        var img = new Image();
        img.onload = function(){
          var canvas = document.createElement('CANVAS');
          var ctx = canvas.getContext('2d');
          canvas.height = this.height;
          canvas.width = this.width;
          ctx.drawImage(this, 0, 0);
          base_data = canvas.toDataURL('image/jpeg', 1.0).replace(/^data:image.+;base64,/, '');
        };
        img.src = url;
        $('#photo').attr('src', url).removeClass("d-none");
        $('#video').hide();
      }
      reader.readAsDataURL(this.files[0]);
    }
  });
});
</script>
</body>
</html>
